<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>12 Bubbles</title>
<style>
/* ================== Reset & Basic ================== */
html, body { margin:0; padding:0; height:100vh; overflow:hidden; font-family: monospace; background-color:#0a0a0a; color:#fff; text-align:center; }
/* ================== LOADING SCREEN ================== */
#loadingScreen { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; display:flex; justify-content:center; align-items:center; color:#fff; font-size:50px; font-weight:bold; z-index:3000; animation:eyeGlow 2s ease-in-out forwards;}
@keyframes eyeGlow { 0% { opacity:0.2; text-shadow:none; } 50% { opacity:1; text-shadow:0 0 25px #fff,0 0 50px #fff,0 0 75px #fff; } 100% { opacity:0.2; text-shadow:none; } }
/* ================== BUTTONS ================== */
#startBtn, #indexBtn, #settingsBtn { display:none; margin:0 auto; font-size:28px; padding:15px 35px; background: linear-gradient(45deg,#a044ff,#6a00f4,#d166ff); border:none; border-radius:12px; color:#fff; font-weight:bold; text-transform:uppercase; cursor:pointer; box-shadow:0 0 10px #d166ff,0 0 20px #a044ff; z-index:1000; transition: transform 0.2s; }
#startBtn:hover, #indexBtn:hover, #settingsBtn:hover { transform: scale(1.05); }
#startBtn { margin-top:30vh; }
#indexBtn, #settingsBtn { margin-top:20px; }
/* ================== SETTINGS PANEL ================== */
#settingsPanel { position:fixed; top:100%; left:0; width:100%; max-height:70%; background:rgba(10,10,10,0.95); overflow-y:auto; transition:top 0.5s ease; padding:20px; z-index:999; box-shadow:0 -5px 30px #d166ff; text-align:left; }
#settingsPanel h2 { text-transform:uppercase; text-align:center; }
#settingsPanel .closeBtn { position:absolute; top:15px; right:15px; font-size:28px; cursor:pointer; color:#fff; font-weight:bold; z-index:1001; }
.settingSection { margin:20px 0; }
.settingTitle { font-size:24px; margin-bottom:15px; color:#d166ff; }
.settingOption { display:flex; align-items:center; margin:10px 0; padding:10px; background:rgba(160,68,255,0.1); border-radius:8px; cursor:pointer; transition: background 0.3s; }
.settingOption:hover { background:rgba(160,68,255,0.2); }
.settingOption.selected { background:rgba(160,68,255,0.3); border:2px solid #d166ff; }
.optionPreview { width:60px; height:60px; margin-right:15px; border-radius:50%; display:flex; justify-content:center; align-items:center; font-weight:bold; color:#fff; border:2px solid #d166ff; box-shadow:0 0 15px #d166ff inset; }
.optionName { font-size:18px; }
/* ================== DIFFICULTY SELECTION ================== */
#difficultySelection { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:none; flex-direction:column; justify-content:center; align-items:center; z-index:998; }
.difficultyTitle { font-size:40px; margin-bottom:30px; color:#d166ff; text-shadow:0 0 10px #d166ff; }
.difficultyBtn { margin:10px; font-size:24px; padding:15px 30px; background: linear-gradient(45deg,#a044ff,#6a00f4,#d166ff); border:none; border-radius:10px; color:#fff; font-weight:bold; cursor:pointer; box-shadow:0 0 10px #d166ff; transition: transform 0.2s; width:200px; }
.difficultyBtn:hover { transform: scale(1.05); }
#backBtn { margin-top:20px; font-size:20px; padding:10px 20px; background: linear-gradient(45deg,#666,#333); border:none; border-radius:8px; color:#fff; cursor:pointer; }
/* ================== COUNTDOWN & SCORE ================== */
#countdown { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); font-size:80px; color:#d166ff; text-shadow:0 0 20px #d166ff,0 0 40px #a044ff; z-index:1001; display:none; }
#scoreContainer { position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:1001; display:none; }
#highscore { font-size:20px; color:#ff0; margin-bottom:5px; }
#score { font-size:28px; color:#d166ff; }
#lives { font-size:20px; color:#f00; margin-top:5px; }
/* ================== BUBBLES ================== */
.bubble { width:80px; height:80px; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:24px; font-weight:bold; color:#fff; background:linear-gradient(135deg,#a044ff,#6a00f4); border:2px solid #d166ff; box-shadow:0 0 10px #d166ff,0 0 20px #a044ff inset; position:absolute; cursor:pointer; animation:floatY 3s infinite alternate ease-in-out; transition: transform 0.2s; }
.bubble:hover { transform: scale(1.1); }
.bubble.rare2x { background: linear-gradient(135deg,#ffff00,#a044ff); color:#000; font-size:28px; animation:floatY 2.5s infinite alternate ease-in-out; }
.bubble.rare144 { background: linear-gradient(135deg,#0f0,#0a0); color:#000; font-size:28px; animation:floatY 2s infinite alternate ease-in-out; }
.bubble.triple { background: linear-gradient(135deg,#f0f,#a0a); color:#fff; font-size:24px; animation:floatY 3s infinite alternate ease-in-out; }
.bubble.gravity { background: linear-gradient(135deg,#fff,#d166ff); color:#000; font-size:28px; animation:floatY 3s infinite alternate ease-in-out; }
.bubble.invert { background: linear-gradient(135deg,#fff,#000); color:#0ff; font-size:26px; animation:floatY 2.8s infinite alternate ease-in-out; }
.bubble.instawin { background: linear-gradient(135deg,#ff0000,#ffff00); color:#000; font-size:32px; box-shadow:0 0 30px #ff0, 0 0 60px #f00; animation:floatY 1.8s infinite alternate ease-in-out; }

/* Halloween Skin - více Halloweenský */
.halloween { background-color: #1a0f0f; }
.halloween .bubble { 
  background:linear-gradient(135deg,#ff8c00,#8b0000); 
  border:2px solid #ff4500; 
  box-shadow:0 0 15px #ff8c00,0 0 25px #8b0000 inset, 0 0 5px #000;
  text-shadow: 1px 1px 2px #000;
}
.halloween .bubble.rare2x { 
  background: linear-gradient(135deg,#ffd700,#ff8c00); 
  color:#000;
  border:2px solid #ffd700;
  box-shadow:0 0 20px #ffd700,0 0 30px #ff8c00 inset;
}
.halloween .bubble.rare144 { 
  background: linear-gradient(135deg,#32cd32,#006400); 
  color:#000;
  border:2px solid #32cd32;
  box-shadow:0 0 20px #32cd32,0 0 30px #006400 inset;
}
.halloween .bubble.triple { 
  background: linear-gradient(135deg,#8b008b,#4b0082); 
  color:#fff;
  border:2px solid #8b008b;
  box-shadow:0 0 20px #8b008b,0 0 30px #4b0082 inset;
}
.halloween .bubble.gravity { 
  background: linear-gradient(135deg,#fff,#ff8c00); 
  color:#000;
  border:2px solid #fff;
  box-shadow:0 0 20px #fff,0 0 30px #ff8c00 inset;
}
.halloween .bubble.invert { 
  background: linear-gradient(135deg,#fff,#000); 
  color:#ff8c00;
  border:2px solid #ff8c00;
  box-shadow:0 0 20px #ff8c00,0 0 30px #000 inset;
}
.halloween .bubble.instawin { 
  background: linear-gradient(135deg,#ff0000,#ff8c00); 
  color:#000; 
  border:2px solid #ff0000;
  box-shadow:0 0 30px #ff8c00, 0 0 60px #ff0000, 0 0 90px #ff4500;
  animation: halloweenGlow 1.5s infinite alternate;
}

/* Halloween UI Elements */
.halloween #startBtn, 
.halloween #indexBtn, 
.halloween #settingsBtn {
  background: linear-gradient(45deg,#ff8c00,#8b0000,#ff4500);
  box-shadow:0 0 10px #ff8c00,0 0 20px #8b0000;
  border: 1px solid #ff4500;
}

.halloween #difficultySelection {
  background:rgba(26,15,15,0.95);
}

.halloween .difficultyTitle {
  color:#ff8c00;
  text-shadow:0 0 10px #ff8c00, 0 0 20px #8b0000;
}

.halloween .difficultyBtn {
  background: linear-gradient(45deg,#ff8c00,#8b0000,#ff4500);
  box-shadow:0 0 10px #ff8c00,0 0 20px #8b0000;
  border: 1px solid #ff4500;
}

.halloween #backBtn {
  background: linear-gradient(45deg,#666,#333);
  border: 1px solid #ff8c00;
}

.halloween #settingsPanel {
  background:rgba(26,15,15,0.95);
  box-shadow:0 -5px 30px #ff8c00;
}

.halloween #settingsPanel h2 {
  color:#ff8c00;
}

.halloween .settingTitle {
  color:#ff8c00;
}

.halloween .settingOption {
  background:rgba(255,140,0,0.1);
  border: 1px solid #ff4500;
}

.halloween .settingOption:hover {
  background:rgba(255,140,0,0.2);
}

.halloween .settingOption.selected {
  background:rgba(255,140,0,0.3);
  border:2px solid #ff8c00;
}

.halloween .optionPreview {
  border:2px solid #ff8c00;
  box-shadow:0 0 15px #ff8c00 inset;
}

.halloween #indexPanel {
  background:rgba(26,15,15,0.95);
  box-shadow:0 -5px 30px #ff8c00;
}

.halloween #indexPanel h2 {
  color:#ff8c00;
}

.halloween .indexItem .bubbleImg {
  border:2px solid #ff8c00;
  box-shadow:0 0 15px #ff8c00 inset;
}

.halloween #countdown {
  color:#ff8c00;
  text-shadow:0 0 20px #ff8c00,0 0 40px #8b0000;
}

.halloween #score {
  color:#ff8c00;
}

.halloween #pauseBtn {
  background: linear-gradient(45deg,#ff8c00,#8b0000);
  border: 1px solid #ff4500;
}

.halloween #continueGameBtn,
.halloween #endGameBtn,
.halloween #continueBtn {
  background: linear-gradient(45deg,#ff8c00,#8b0000,#ff4500);
  box-shadow:0 0 10px #ff8c00,0 0 20px #8b0000;
  border: 1px solid #ff4500;
}

@keyframes halloweenGlow {
  0% { box-shadow:0 0 20px #ff8c00, 0 0 40px #ff0000, 0 0 60px #ff4500; }
  100% { box-shadow:0 0 30px #ff8c00, 0 0 60px #ff0000, 0 0 90px #ff4500; }
}

@keyframes floatY { 0% { transform: translateY(0);} 100% { transform: translateY(-15px);} }
/* ================== INDEX PANEL ================== */
#indexPanel { position:fixed; top:100%; left:0; width:100%; max-height:70%; background:rgba(10,10,10,0.95); overflow-y:auto; transition:top 0.5s ease; padding:20px; z-index:999; box-shadow:0 -5px 30px #d166ff; text-align:left; }
#indexPanel h2 { text-transform:uppercase; text-align:center; }
#indexPanel .closeBtn { position:absolute; top:15px; right:15px; font-size:28px; cursor:pointer; color:#fff; font-weight:bold; z-index:1001; }
.indexItem { display:flex; align-items:center; margin:10px 0; }
.indexItem .bubbleImg { width:60px; height:60px; margin-right:15px; border-radius:50%; display:flex; justify-content:center; align-items:center; font-weight:bold; color:#fff; border:2px solid #d166ff; box-shadow:0 0 15px #d166ff inset; animation:float 1s infinite alternate; }
.indexItem .desc { flex:1; }
.indexItem .rarity { font-weight:bold; }
@keyframes float { 0%{transform:translateY(0);} 100%{transform:translateY(-10px);} }
/* ================== END SCREEN ================== */
#endScreen { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:none; flex-direction:column; justify-content:center; align-items:center; color:#fff; font-size:40px; z-index:1500; }
#continueBtn { margin-top:30px; font-size:26px; padding:15px 40px; border:none; border-radius:10px; cursor:pointer; color:#fff; background: linear-gradient(45deg,#a044ff,#6a00f4,#d166ff); box-shadow:0 0 10px #d166ff,0 0 20px #a044ff; }
/* ================== VERSION LABEL ================== */
#versionLabel { position:fixed; top:10px; right:10px; font-size:16px; color:rgba(255,255,255,0.3); font-weight:bold; z-index:1002; pointer-events:none; }
/* ================== EASTER EGG ================== */
#easterEgg { position: fixed; top: 0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); color:red; font-size:150px; font-weight:bold; display:flex; justify-content:center; align-items:center; z-index:2000; display:none; text-transform:uppercase; opacity:0; animation:fadeShake 5s forwards; }
@keyframes fadeShake { 0%{opacity:0; transform:translateX(0);} 10%{opacity:1; transform:translateX(-5px);} 20%{transform:translateX(5px);} 30%{transform:translateX(-5px);} 40%{transform:translateX(5px);} 50%{transform:translateX(-5px);} 60%{transform:translateX(5px);} 70%{transform:translateX(-5px);} 80%{transform:translateX(5px);} 90%{transform:translateX(-5px);} 100%{opacity:0; transform:translateX(0);} }
/* ================== PAUSE SCREEN ================== */
#pauseScreen { position: fixed; top: 0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); color:#fff; display: none; flex-direction: column; justify-content: center; align-items: center; z-index:2000; opacity:0; backdrop-filter: blur(5px); animation-fill-mode: forwards; }
#pauseScreen.fadeIn { animation: fadeIn 0.5s forwards; }
#pauseScreen.fadeOut { animation: fadeOut 0.5s forwards; }
@keyframes fadeIn { 0% { opacity:0; transform:scale(0.9);} 100%{ opacity:1; transform:scale(1);} }
@keyframes fadeOut { 0% { opacity:1; transform:scale(1);} 100%{ opacity:0; transform:scale(0.9);} }
#pauseText { font-size:60px; font-weight:bold; margin-bottom:30px; text-shadow:0 0 20px #fff; }
#continueGameBtn, #endGameBtn { font-size:28px; padding:15px 40px; margin:10px; border:none; border-radius:10px; cursor:pointer; color:#fff; background:linear-gradient(45deg,#a044ff,#6a00f4,#d166ff); box-shadow:0 0 10px #d166ff,0 0 20px #a044ff; }
/* ================== PAUSE BUTTON ================== */
#pauseBtn { position: fixed; top:10px; left:10px; font-size:28px; padding:10px 8px; border:none; border-radius:8px; background: linear-gradient(45deg,#a044ff,#6a00f4); color:#fff; cursor:pointer; z-index:1001; display:none; text-shadow:0 0 10px #fff; }

</style>
</head>
<body>

<div id="loadingScreen">Level 12 studio</div>
<div id="versionLabel">Released 1.4</div>
<button id="startBtn">START</button>
<button id="indexBtn">INDEX</button>
<button id="settingsBtn">SETTINGS</button>

<div id="settingsPanel">
  <div class="closeBtn">✖</div>
  <h2 id="settingsTitle">SETTINGS</h2>
  
  <div class="settingSection">
    <div class="settingTitle" id="languageTitle">Language</div>
    <div class="settingOption" data-setting="language" data-value="cs">
      <div class="optionPreview">CZ</div>
      <div class="optionName">Čeština</div>
    </div>
    <div class="settingOption" data-setting="language" data-value="en">
      <div class="optionPreview">EN</div>
      <div class="optionName">English</div>
    </div>
  </div>
  
  <div class="settingSection">
    <div class="settingTitle" id="skinTitle">Skin</div>
    <div class="settingOption" data-setting="skin" data-value="normal">
      <div class="optionPreview" style="background:linear-gradient(135deg,#a044ff,#6a00f4);">12</div>
      <div class="optionName">Normal</div>
    </div>
    <div class="settingOption" data-setting="skin" data-value="halloween">
      <div class="optionPreview" style="background:linear-gradient(135deg,#ff8c00,#8b0000);">12</div>
      <div class="optionName">Halloween</div>
    </div>
  </div>
</div>

<div id="difficultySelection">
  <div class="difficultyTitle" id="difficultyTitle">Select Difficulty</div>
  <button class="difficultyBtn" data-difficulty="easy">Easy</button>
  <button class="difficultyBtn" data-difficulty="normal">Normal</button>
  <button class="difficultyBtn" data-difficulty="hard">Hard</button>
  <button id="backBtn">Back</button>
</div>

<div id="indexPanel">
  <div class="closeBtn">✖</div>
  <h2 id="indexTitle">BUBBLES INDEX</h2>
  <div class="indexItem"><div class="bubbleImg">12</div><div class="desc"><span class="rarity" id="commonRarity">Common:</span> <span id="commonDesc">+1 score</span></div></div>
  <div class="indexItem"><div class="bubbleImg" style="background: linear-gradient(135deg,#ffff00,#a044ff); color:#000;">12×2</div><div class="desc"><span class="rarity" id="rare2xRarity">Rare 0.25%:</span> <span id="rare2xDesc">Doubles score</span></div></div>
  <div class="indexItem"><div class="bubbleImg" style="background: linear-gradient(135deg,#0f0,#0a0); color:#000;">12²</div><div class="desc"><span class="rarity" id="rare144Rarity">Rare 1%:</span> <span id="rare144Desc">+144 score</span></div></div>
  <div class="indexItem"><div class="bubbleImg" style="background: linear-gradient(135deg,#f0f,#a0a);">3×12</div><div class="desc"><span class="rarity" id="tripleRarity">Rare 2%:</span> <span id="tripleDesc">Spawns 3 bubbles</span></div></div>
  <div class="indexItem"><div class="bubbleImg" style="background: linear-gradient(135deg,#fff,#d166ff); color:#000;">&lt;12&gt;</div><div class="desc"><span class="rarity" id="gravityRarity">Rare 3%:</span> <span id="gravityDesc">Gravity bubble teleports all bubbles to it</span></div></div>
  <div class="indexItem"><div class="bubbleImg" style="background: linear-gradient(135deg,#fff,#000); color:#0ff;">!12!</div><div class="desc"><span class="rarity" id="invertRarity">Rare 1.5%:</span> <span id="invertDesc">Inverts screen colors for 5 seconds and gives +10 score</span></div></div>
  <div class="indexItem"><div class="bubbleImg" style="background: linear-gradient(135deg,#ff0000,#ffff00); color:#000; box-shadow:0 0 30px #ff0,0 0 60px #f00;">?12?</div><div class="desc"><span class="rarity" id="instawinRarity">Rare 0.1%:</span> <span id="instawinDesc">Instant win (+999 999 999 score)</span></div></div>
</div>

<div id="countdown"></div>
<div id="scoreContainer">
  <div id="highscore">Highscore: 0</div>
  <div id="score">Score: 0</div>
  <div id="lives">Lives: 3</div>
</div>

<div id="pauseBtn">||</div>

<div id="pauseScreen">
  <div id="pauseText">PAUSED</div>
  <button id="continueGameBtn">Continue</button>
  <button id="endGameBtn">End Game</button>
</div>

<div id="endScreen">
  <div id="finalScoreText"></div>
  <button id="continueBtn">CONTINUE</button>
</div>

<div id="easterEgg"></div>

<audio id="popSound" src="https://www.soundjay.com/button/sounds/button-16.mp3"></audio>

<script>
// ================== TRANSLATIONS ==================
const translations = {
  en: {
    startBtn: "START",
    indexBtn: "INDEX",
    settingsBtn: "SETTINGS",
    settingsTitle: "SETTINGS",
    indexTitle: "BUBBLES INDEX",
    commonRarity: "Common:",
    commonDesc: "+1 score",
    rare2xRarity: "Rare 0.25%:",
    rare2xDesc: "Doubles score",
    rare144Rarity: "Rare 1%:",
    rare144Desc: "+144 score",
    tripleRarity: "Rare 2%:",
    tripleDesc: "Spawns 3 bubbles",
    gravityRarity: "Rare 3%:",
    gravityDesc: "Gravity bubble teleports all bubbles to it",
    invertRarity: "Rare 1.5%:",
    invertDesc: "Inverts screen colors for 5 seconds and gives +10 score",
    instawinRarity: "Rare 0.1%:",
    instawinDesc: "Instant win (+999 999 999 score)",
    highscore: "Highscore: ",
    score: "Score: ",
    lives: "Lives: ",
    pauseText: "PAUSED",
    continueGameBtn: "Continue",
    endGameBtn: "End Game",
    finalScoreText: "Your score: ",
    continueBtn: "CONTINUE",
    difficultyTitle: "Select Difficulty",
    languageTitle: "Language",
    skinTitle: "Skin",
    backBtn: "Back"
  },
  cs: {
    startBtn: "START",
    indexBtn: "INDEX",
    settingsBtn: "NASTAVENÍ",
    settingsTitle: "NASTAVENÍ",
    indexTitle: "INDEX BUBLIN",
    commonRarity: "Běžná:",
    commonDesc: "+1 skóre",
    rare2xRarity: "Vzácná 0,25%:",
    rare2xDesc: "Zdvojnásobí skóre",
    rare144Rarity: "Vzácná 1%:",
    rare144Desc: "+144 skóre",
    tripleRarity: "Vzácná 2%:",
    tripleDesc: "Spawne 3 bubliny",
    gravityRarity: "Vzácná 3%:",
    gravityDesc: "Gravitační bublina teleportuje všechny bubliny k ní",
    invertRarity: "Vzácná 1,5%:",
    invertDesc: "Obrátí barvy obrazovky na 5 sekund a dá +10 skóre",
    instawinRarity: "Vzácná 0,1%:",
    instawinDesc: "Okamžité vítězství (+999 999 999 skóre)",
    highscore: "Nejvyšší skóre: ",
    score: "Skóre: ",
    lives: "Životy: ",
    pauseText: "PAUZA",
    continueGameBtn: "Pokračovat",
    endGameBtn: "Konec",
    finalScoreText: "Tvé skóre: ",
    continueBtn: "POKRAČOVAT",
    difficultyTitle: "Vyberte Obtížnost",
    languageTitle: "Jazyk",
    skinTitle: "Skin",
    backBtn: "Zpět"
  }
};

// ================== ELEMENTS ==================
const startBtn = document.getElementById('startBtn');
const indexBtn = document.getElementById('indexBtn');
const settingsBtn = document.getElementById('settingsBtn');
const indexPanel = document.getElementById('indexPanel');
const settingsPanel = document.getElementById('settingsPanel');
const countdownEl = document.getElementById('countdown');
const scoreContainer = document.getElementById('scoreContainer');
const scoreEl = document.getElementById('score');
const highscoreEl = document.getElementById('highscore');
const livesEl = document.getElementById('lives');
const popSound = document.getElementById('popSound');
const endScreen = document.getElementById('endScreen');
const finalScoreText = document.getElementById('finalScoreText');
const versionLabel = document.getElementById('versionLabel');
const easterEl = document.getElementById('easterEgg');
const closeBtn = document.querySelector('#indexPanel .closeBtn');
const settingsCloseBtn = document.querySelector('#settingsPanel .closeBtn');
const difficultySelection = document.getElementById('difficultySelection');
const backBtn = document.getElementById('backBtn');

const pauseBtn = document.getElementById('pauseBtn');
const pauseScreen = document.getElementById('pauseScreen');
const continueGameBtn = document.getElementById('continueGameBtn');
const endGameBtn = document.getElementById('endGameBtn');
const continueBtn = document.getElementById('continueBtn');

let score = 0, highscore = 0, lives = 3, bubbles = [], gameRunning = false, gamePaused = false, startTime;
let currentLanguage = 'cs';
let currentDifficulty = 'normal';
let currentSkin = 'normal';

// ================== LOADING SCREEN & INIT ==================
window.addEventListener('load', () => {
  loadSettings();
  setTimeout(() => {
    document.getElementById('loadingScreen').style.display = 'none';
    startBtn.style.display = 'block';
    indexBtn.style.display = 'block';
    settingsBtn.style.display = 'block';
    attachButtonEvents();
    updateLanguage();
    applySkin();
  }, 2000);
});

// ================== LOCAL STORAGE ==================
function loadSettings() {
  const savedLanguage = localStorage.getItem('12bubbles-language');
  const savedSkin = localStorage.getItem('12bubbles-skin');
  const savedHighscore = localStorage.getItem('12bubbles-highscore');
  
  if (savedLanguage) currentLanguage = savedLanguage;
  if (savedSkin) currentSkin = savedSkin;
  if (savedHighscore) highscore = parseInt(savedHighscore);
  
  // Update UI to reflect saved settings
  updateSettingSelection('language', currentLanguage);
  updateSettingSelection('skin', currentSkin);
}

function saveSettings() {
  localStorage.setItem('12bubbles-language', currentLanguage);
  localStorage.setItem('12bubbles-skin', currentSkin);
  localStorage.setItem('12bubbles-highscore', highscore);
}

function updateSettingSelection(setting, value) {
  document.querySelectorAll(`[data-setting="${setting}"]`).forEach(option => {
    if (option.dataset.value === value) {
      option.classList.add('selected');
    } else {
      option.classList.remove('selected');
    }
  });
}

// ================== LANGUAGE MANAGEMENT ==================
function updateLanguage() {
  const lang = translations[currentLanguage];
  
  // Update buttons
  startBtn.textContent = lang.startBtn;
  indexBtn.textContent = lang.indexBtn;
  settingsBtn.textContent = lang.settingsBtn;
  backBtn.textContent = lang.backBtn;
  
  // Update panels
  document.getElementById('settingsTitle').textContent = lang.settingsTitle;
  document.getElementById('indexTitle').textContent = lang.indexTitle;
  document.getElementById('commonRarity').textContent = lang.commonRarity;
  document.getElementById('commonDesc').textContent = lang.commonDesc;
  document.getElementById('rare2xRarity').textContent = lang.rare2xRarity;
  document.getElementById('rare2xDesc').textContent = lang.rare2xDesc;
  document.getElementById('rare144Rarity').textContent = lang.rare144Rarity;
  document.getElementById('rare144Desc').textContent = lang.rare144Desc;
  document.getElementById('tripleRarity').textContent = lang.tripleRarity;
  document.getElementById('tripleDesc').textContent = lang.tripleDesc;
  document.getElementById('gravityRarity').textContent = lang.gravityRarity;
  document.getElementById('gravityDesc').textContent = lang.gravityDesc;
  document.getElementById('invertRarity').textContent = lang.invertRarity;
  document.getElementById('invertDesc').textContent = lang.invertDesc;
  document.getElementById('instawinRarity').textContent = lang.instawinRarity;
  document.getElementById('instawinDesc').textContent = lang.instawinDesc;
  
  // Update settings
  document.getElementById('difficultyTitle').textContent = lang.difficultyTitle;
  document.getElementById('languageTitle').textContent = lang.languageTitle;
  document.getElementById('skinTitle').textContent = lang.skinTitle;
  
  // Update game UI if game is running
  if (gameRunning) {
    highscoreEl.textContent = lang.highscore + highscore;
    scoreEl.textContent = lang.score + score;
    livesEl.textContent = lang.lives + lives;
    document.getElementById('pauseText').textContent = lang.pauseText;
    continueGameBtn.textContent = lang.continueGameBtn;
    endGameBtn.textContent = lang.endGameBtn;
    finalScoreText.textContent = lang.finalScoreText + score;
    continueBtn.textContent = lang.continueBtn;
  }
}

// ================== SKIN MANAGEMENT ==================
function applySkin() {
  // Remove all skin classes
  document.body.classList.remove('halloween');
  
  // Add current skin class
  if (currentSkin === 'halloween') {
    document.body.classList.add('halloween');
  }
}

// ================== BUTTON LOGIC ==================
function attachButtonEvents() {
  startBtn.addEventListener('click', showDifficultySelection);
  indexBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    if (indexPanel.style.top === '30%') {
      indexPanel.style.top = '100%';
      showMainButtons();
    } else {
      indexPanel.style.top = '30%';
      hideMainButtons();
    }
  });
  settingsBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    if (settingsPanel.style.top === '30%') {
      settingsPanel.style.top = '100%';
      showMainButtons();
    } else {
      settingsPanel.style.top = '30%';
      hideMainButtons();
    }
  });
  
  // Close buttons
  closeBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    indexPanel.style.top = '100%';
    showMainButtons();
  });
  settingsCloseBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    settingsPanel.style.top = '100%';
    showMainButtons();
  });
  
  // Back button
  backBtn.addEventListener('click', () => {
    difficultySelection.style.display = 'none';
    showMainButtons();
  });
  
  // Settings options
  document.querySelectorAll('.settingOption').forEach(option => {
    option.addEventListener('click', (e) => {
      const setting = e.currentTarget.dataset.setting;
      const value = e.currentTarget.dataset.value;
      
      if (setting === 'language') {
        currentLanguage = value;
        updateLanguage();
      } else if (setting === 'skin') {
        currentSkin = value;
        applySkin();
      }
      
      updateSettingSelection(setting, value);
      saveSettings();
    });
  });
  
  document.body.addEventListener('click', () => {
    if (indexPanel.style.top === '30%') {
      indexPanel.style.top = '100%';
      showMainButtons();
    }
    if (settingsPanel.style.top === '30%') {
      settingsPanel.style.top = '100%';
      showMainButtons();
    }
  });
  
  continueBtn.addEventListener('click', () => {
    endScreen.style.display = 'none';
    showMainButtons();
    versionLabel.style.display = 'block';
  });
  pauseBtn.addEventListener('click', togglePause);
  continueGameBtn.addEventListener('click', togglePause);
  endGameBtn.addEventListener('click', endGame);
  
  // Difficulty selection
  document.querySelectorAll('.difficultyBtn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      if (e.target.id !== 'backBtn') {
        currentDifficulty = e.target.dataset.difficulty;
        difficultySelection.style.display = 'none';
        startCountdown();
      }
    });
  });
}

function showMainButtons() {
  startBtn.style.display = 'block';
  indexBtn.style.display = 'block';
  settingsBtn.style.display = 'block';
}

function hideMainButtons() {
  startBtn.style.display = 'none';
  indexBtn.style.display = 'none';
  settingsBtn.style.display = 'none';
}

// ================== DIFFICULTY SELECTION ==================
function showDifficultySelection() {
  hideMainButtons();
  difficultySelection.style.display = 'flex';
}

// ================== COUNTDOWN ==================
function startCountdown() {
  versionLabel.style.display = 'none';
  countdownEl.style.display = 'block';
  let count = 3;
  countdownEl.textContent = count;
  const interval = setInterval(() => {
    count--;
    if (count > 0) countdownEl.textContent = count;
    else {
      clearInterval(interval);
      countdownEl.style.display = 'none';
      scoreContainer.style.display = 'block';
      pauseBtn.style.display = 'block';
      startGame();
    }
  }, 1000);
}

// ================== GAME LOGIC ==================
function startGame() {
  score = 0;
  lives = 3;
  bubbles = [];
  gameRunning = true;
  gamePaused = false;
  startTime = Date.now();
  
  // Set initial lives based on difficulty - LEHČÍ OBTÍŽNOSTI
  if (currentDifficulty === 'easy') {
    lives = 6; // Zvýšeno z 5 na 6
  } else if (currentDifficulty === 'hard') {
    lives = 3; // Zvýšeno z 2 na 3
  }
  
  const lang = translations[currentLanguage];
  scoreEl.textContent = lang.score + score;
  livesEl.textContent = lang.lives + lives;
  highscoreEl.textContent = lang.highscore + highscore;
  
  spawnBubble();
  requestAnimationFrame(updateBubbles);
}

function togglePause() {
  if (!gameRunning) return;
  gamePaused = !gamePaused;
  if (gamePaused) {
    pauseScreen.classList.remove('fadeOut');
    pauseScreen.classList.add('fadeIn');
    pauseScreen.style.display = 'flex';
  } else {
    pauseScreen.classList.remove('fadeIn');
    pauseScreen.classList.add('fadeOut');
    setTimeout(() => pauseScreen.style.display = 'none', 500);
  }
}

// ================== UPDATE BUBBLES ==================
function updateBubbles() {
  if (!gameRunning) return;
  if (!gamePaused) {
    bubbles.forEach(bubble => {
      const top = parseFloat(bubble.style.top);
      
      // Adjust speed based on difficulty - LEHČÍ OBTÍŽNOSTI
      let speedMultiplier = 1;
      if (currentDifficulty === 'easy') speedMultiplier = 0.6; // Zpomaleno z 0.7
      else if (currentDifficulty === 'hard') speedMultiplier = 1.3; // Zpomaleno z 1.5
      
      bubble.style.top = (top - parseFloat(bubble.dataset.speed) * speedMultiplier) + 'px';
      
      if (top <= 0) {
        lives--;
        const lang = translations[currentLanguage];
        livesEl.textContent = lang.lives + lives;
        bubble.remove();
        bubbles = bubbles.filter(b => b !== bubble);
        if (lives <= 0) endGame();
      }
    });
  }
  requestAnimationFrame(updateBubbles);
}

// ================== SPAWN BUBBLES ==================
function spawnBubble() {
  if (!gameRunning || gamePaused) {
    setTimeout(spawnBubble, 500);
    return;
  }
  
  const elapsed = (Date.now() - startTime) / 1000;
  const speedMultiplier = 1 + elapsed / 120;
  const chance = Math.random();
  
  // Adjust spawn rate based on difficulty - LEHČÍ OBTÍŽNOSTI
  let spawnDelay = 500;
  if (currentDifficulty === 'easy') spawnDelay = 800; // Zpomaleno z 700
  else if (currentDifficulty === 'hard') spawnDelay = 400; // Zpomaleno z 350
  
  const bubble = document.createElement('div');
  bubble.classList.add('bubble');
  
  if (chance <= 0.001) {
    bubble.classList.add('instawin');
    bubble.textContent = "?12?";
    bubble.dataset.type = "instawin";
  } else if (chance <= 0.016) {
    bubble.classList.add('invert');
    bubble.textContent = "!12!";
    bubble.dataset.type = "invert";
  } else if (chance <= 0.0185) {
    bubble.classList.add('rare2x');
    bubble.textContent = "12×2";
    bubble.dataset.type = "2x";
  } else if (chance <= 0.0285) {
    bubble.classList.add('rare144');
    bubble.textContent = "12²";
    bubble.dataset.type = "144";
  } else if (chance <= 0.0485) {
    bubble.classList.add('triple');
    bubble.textContent = "3×12";
    bubble.dataset.type = "triple";
  } else if (chance <= 0.0785) {
    bubble.classList.add('gravity');
    bubble.textContent = "<12>";
    bubble.dataset.type = "gravity";
  } else {
    bubble.textContent = "12";
    bubble.dataset.type = "normal";
  }

  const size = Math.random() * 60 + 60;
  bubble.style.width = size + 'px';
  bubble.style.height = size + 'px';
  bubble.style.fontSize = (bubble.dataset.type === "144" ? size / 2.5 : size / 3) + 'px';
  bubble.style.left = Math.random() * (window.innerWidth - size) + 'px';
  bubble.style.top = (window.innerHeight - size) + 'px';
  bubble.dataset.speed = (Math.random() * 1.5 + 1) * speedMultiplier;
  document.body.appendChild(bubble);

  const pop = () => {
    if (!gameRunning) return;
    if (['2x', '144', 'triple', 'gravity', 'invert', 'instawin'].includes(bubble.dataset.type)) {
      popSound.currentTime = 0;
      popSound.play();
    }
    bubble.remove();
    bubbles = bubbles.filter(b => b !== bubble);
    
    if (bubble.dataset.type === "2x") score *= 2;
    else if (bubble.dataset.type === "144") score += 144;
    else if (bubble.dataset.type === "triple") for (let i = 0; i < 3; i++) spawnSingleBubble();
    else if (bubble.dataset.type === "gravity") {
      const bx = parseFloat(bubble.style.left) + parseFloat(bubble.style.width) / 2;
      const by = parseFloat(bubble.style.top) + parseFloat(bubble.style.height) / 2;
      bubbles.forEach(b => {
        b.style.left = (bx - parseFloat(b.style.width) / 2) + 'px';
        b.style.top = (by - parseFloat(b.style.height) / 2) + 'px';
      });
    } else if (bubble.dataset.type === "invert") {
      document.body.style.filter = 'invert(1)';
      score += 10;
      setTimeout(() => document.body.style.filter = '', 5000);
    } else if (bubble.dataset.type === "instawin") {
      score += 999999999;
    } else score++;
    
    if (score > 999999999) score = 999999999;
    
    const lang = translations[currentLanguage];
    scoreEl.textContent = lang.score + score;
    if (score > highscore) {
      highscore = score;
      highscoreEl.textContent = lang.highscore + highscore;
      saveSettings();
    }
  };

  bubble.addEventListener('click', pop);
  bubble.addEventListener('touchstart', pop);
  bubbles.push(bubble);
  setTimeout(spawnBubble, spawnDelay);
}

function spawnSingleBubble() {
  if (!gameRunning || gamePaused) return;
  
  const elapsed = (Date.now() - startTime) / 1000;
  const speedMultiplier = 1 + elapsed / 120;
  
  const bubble = document.createElement('div');
  bubble.classList.add('bubble');
  bubble.textContent = "12";
  bubble.dataset.type = "normal";
  
  const size = Math.random() * 60 + 60;
  bubble.style.width = size + 'px';
  bubble.style.height = size + 'px';
  bubble.style.fontSize = size / 3 + 'px';
  bubble.style.left = Math.random() * (window.innerWidth - size) + 'px';
  bubble.style.top = (window.innerHeight - size) + 'px';
  bubble.dataset.speed = (Math.random() * 1.5 + 1) * speedMultiplier;
  document.body.appendChild(bubble);

  const pop = () => {
    if (!gameRunning) return;
    score++;
    if (score > 999999999) score = 999999999;
    
    const lang = translations[currentLanguage];
    scoreEl.textContent = lang.score + score;
    if (score > highscore) {
      highscore = score;
      highscoreEl.textContent = lang.highscore + highscore;
      saveSettings();
    }
    bubble.remove();
    bubbles = bubbles.filter(b => b !== bubble);
  };
  
  bubble.addEventListener('click', pop);
  bubble.addEventListener('touchstart', pop);
  bubbles.push(bubble);
}

// ================== END GAME ==================
function endGame() {
  gameRunning = false;
  bubbles.forEach(b => b.remove());
  bubbles = [];
  scoreContainer.style.display = 'none';
  pauseBtn.style.display = 'none';
  pauseScreen.style.display = 'none';
  
  if (score === 12 || score <= 3) {
    easterEl.textContent = (score === 12 ? '12' : 'BRUH');
    easterEl.style.display = 'flex';
    easterEl.style.animation = 'fadeShake 5s forwards';
    setTimeout(() => {
      easterEl.style.display = 'none';
      showEndScreen();
    }, 5000);
  } else {
    showEndScreen();
  }
}

function showEndScreen() {
  const lang = translations[currentLanguage];
  finalScoreText.textContent = lang.finalScoreText + score;
  endScreen.style.display = 'flex';
}
</script>
</body>
</html>
